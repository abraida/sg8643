<!doctype html>
<html>
    <head>
        <title></title>        
        <style>
            body{ background-color: grey; }
            canvas{ background-color: white; }
			textarea{ background-color: black; foreground-color: white;}
        </style>
    </head>
    <body>

		<div id="contenedor3d">
			<center>    		            
				<canvas id="canvas" width=1500 height=1000>
					Your browser does not support the HTML5 canvas element.
				</canvas>    		
			</center>
		</div>

        <script type="text/javascript" src="js/import/gl-matrix.js"></script>
        <script src="js/import/dat.gui.js"></script>
		<script src="js/import/jquery-3.6.1.min.js"></script>
        
        <script src="js/src/paths.js"></script>
        <script src="js/src/shapes.js"></script>

        <script src="js/src/superficies.js"></script>
		<script src="js/src/Objeto.js"></script>
		<script src="js/src/Castillo.js"></script>
		<script src="js/src/Catapulta.js"></script>
		<script src="js/src/Terreno.js"></script>
		<script src="js/src/Camara.js"></script>
		<script src="js/init.js"></script>
        
        <script src="js/main.js"></script>
		<script src="js/src/interfaz.js"></script>



        <script id="shader-vs" type="x-shader/x-vertex">
            precision highp float;

            attribute vec3 aVertexPosition;
            attribute vec3 aVertexNormal;
            attribute vec2 aTextureCoord;

            uniform mat4 modelMatrix;            
            uniform mat4 viewMatrix;
            uniform mat4 projMatrix;
            
            uniform mat4 normalMatrix;

            uniform vec3 aColor;

            varying vec3 vNormal;    
            varying vec3 vPosWorld;  
            varying vec3 vColor;

            varying vec2 vTextureCoord;


            void main(void) {
                gl_Position = projMatrix * viewMatrix * modelMatrix * vec4(aVertexPosition, 1.0);

                vPosWorld=(modelMatrix*vec4(aVertexPosition,1.0)).xyz;    //la posicion en coordenadas de mundo
                vNormal=(normalMatrix*vec4(aVertexNormal,1.0)).xyz;       //la normal en coordenadas de mundo   

                vColor = aColor;    
                vTextureCoord = aTextureCoord;
                
            }
        </script>

        <script id="shader-fs" type="x-shader/x-fragment">
            precision highp float;
            varying vec3 vNormal;
            varying vec3 vPosWorld;

            varying vec3 vColor;
            
            varying vec2 vTextureCoord;
            uniform sampler2D uZincTex;

            uniform vec3 uAmbientColor;	    
            uniform vec3 uDirectionalPos;        
            uniform vec3 uDirectionalColor;   
            uniform vec3 uSpecularColor;

            uniform vec3 lightPos; // Light position

            uniform bool usarTextura;
            
            void main(void) {
                float Ka = .8;  
                float Kd = .8;   
                float Ks = .8;   

                float shininessVal = 30.0;

                vec3 N = normalize(vNormal);
                vec3 L = normalize(uDirectionalPos - vPosWorld);

                float lambertian = max(dot(N, L), 0.0);
                float specular = 0.0;

                if(lambertian > 0.0) {
                    vec3 R = reflect(-L, N);      // Reflected light vector
                    vec3 V = normalize(-vPosWorld); // Vector to viewer
                    // Compute the specular term
                    float specAngle = max(dot(R, V), 0.0);
                    specular = pow(specAngle, shininessVal);
                }

                vec3 color = Ka * uAmbientColor +
                                    Kd * lambertian * uDirectionalColor +
                                    Ks * specular * uSpecularColor;
                
                if (usarTextura) {
                    vec3 tex = texture2D(uZincTex, vTextureCoord).xyz;
 
                    color = uAmbientColor * tex +
                            lambertian * uDirectionalColor * tex +
                            Ks * specular * uSpecularColor;        
                }

                else {
                    color = Ka * uAmbientColor * vColor +
                            Kd * lambertian * uDirectionalColor * vColor +
                            Ks * specular * uSpecularColor;     
                }

                gl_FragColor = vec4(color,1.0);

            }
        </script>
        
        <script>

        </script>
    </body>
</html>
